#!/bin/bash

DIRTMPSHARED="/tmp/shared_folder"
for USERDEST in $($ZMCONTROL -l gaa) ; do 

#   LISTAR PASTAS COMPARTILHADAS NA CONTA
ZMLISTFOLDER="$ZMMAILBOX -z -m $USERDEST gaf | grep \) | sed 's/:/|/g' | sed 's/ (/|/g' | sed 's/)/|/g' | awk -F/ '{print \"/\"\$2}' "

    $CONNECT $ZMLISTFOLDER > $DIRTMPSHARED_$USERDEST

FINDTEXT="cat /tmp/shared_folder_$USERDEST"

 if [ -z $FINDTEXT ] ; then  

echo " User $USERDEST does not has shared folder "

else 
    for FOLDERID in $(awk -F"|" '{print $3}' $DIRTMPSHARED_$USERDEST) ; do
        ZMFILTERFILE="$ZMMAILBOX -z -m $(grep -w  ${FOLDERID} $DIRTMPSHARED_$USERDEST |cut -d"|" -f2 ) gaf |  awk -F/ ' \$1 ~ /$FOLDERID/ {print \"/\"\$2}'"

        FOLDERDEST=$(grep -w  $FOLDERID $DIRTMPSHARED_$USERDEST | awk -F"|" '{print $1}')
        USERORIG=$(grep -w  $FOLDERID $DIRTMPSHARED_$USERDEST | awk -F"|" '{print $2}')

        TRADEID=$($CONNECT $ZMFILTERFILE)
        sed -i "s~${FOLDERID}~${TRADEID}~" $DIRTMPSHARED_$USERDEST

        FOLDERORIG=$(grep  -w ${TRADEID} $DIRTMPSHARED_$USERDEST | awk -F"|" '{print $3}' )

        $ZMMAILBOX -z -m $USERDEST df "$FOLDERDEST"


        $ZMMAILBOX -z -m $USERORIG mfg "$TRADEID" account $USERDEST rwixa
        $ZMMAILBOX -z -m $USERDEST cm "$FOLDERDEST" $USERORIG  "$TRADEID"

    done
fi 

done 


